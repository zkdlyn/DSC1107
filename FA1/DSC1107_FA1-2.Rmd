---
title: "FA1: Data Transformation"
author: "Baybayon, Darlyn Antoinette"
output: github_document
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



### 1 Introduction
```{r}
library(tidyverse)
diamonds

```

### 2 Isolating Data
#### 2.1 filter()

```{r}
# subset diamonds priced >=10,000
filter(diamonds, price >= 10000)

# subset diamonds priced >=10,000 and clarity vvs1 or IF
filter(diamonds, price >= 10000 & clarity %in% c("VVS1", "IF"))


```
#### 2.2 select()

```{r}
# select corresponding to 4 Cs
select(diamonds,carat,cut,color,clarity)

```

#### 2.3 arrange()
```{r}
# sort by carat asc
arrange(diamonds, carat)

# sort by carat desc
arrange(diamonds, desc(carat))
```

### 3 Deriving information
#### 3.1 mutate()

```{r}
# add col price per carat of each diamond
mutate(diamonds, price_per_carat = price/carat)

# add col indicating price per carat >= 10,000
mutate(diamonds, fancy_diamond = price/carat > 10000)

# if else for two cases
mutate(diamonds,
       good_value = 
         if_else(
           condition = carat > 2,
           true = price < 5000,
           false = price < 1000
         ))

# case for more than 2 cases
mutate(diamonds,
       value = case_when(
         carat > 2 & price < 5000 ~ "good",
         carat >1 & price < 2500 ~ "ok",
         TRUE ~ "bad"
       ))

```

#### 3.2 summarise()

```{r}
# find the number of fancy diamonds
summarise(diamonds, num_fancy_diamonds = sum(price/carat > 10000))

# find no. of fancy diamond and price mean of a diamond
summarise(diamonds,
          num_fancy_diamonds = sum(price/carat > 10000),
          mean_diamond_price = mean(price))
```
Exercise: Use summarise to determine if there are any diamonds of at least one carat that cost less than $1000

```{r}
summarise(diamonds,
          x= sum(price < 1000 & carat > 1)
          )
```

### 4 Multi-step transformations
#### 4.1 The pipe (%>%)

```{r}
diamonds %>%
  filter(cut == "Premium") %>%
  mutate(price_per_carat = price/carat) %>%
  arrange(desc(price_per_carat))

diamonds %>%
  filter(cut == "Premium") %>%
  mutate(price_per_carat = price/carat) %>%
  ggplot() +
  geom_histogram(aes(x = price_per_carat))
```

Exercise: Compute the mean price for diamonds of volume at least one carat.

#### 4.2 group_by()

```{r}
diamonds %>%
  group_by(cut) %>%
  summarise(max_price = max(price))

diamonds %>%
  group_by(cut, clarity) %>%
  summarise(max_price = max(price))

diamonds %>%
  group_by(cut, clarity) %>%
  summarise(max_price = max(price))%>%
  ungroup()

count(diamonds, cut)
```

#### 4.3 Storing the transformed data

```{r}
diamonds
max_prices <- diamonds %>%
  group_by(cut) %>%
  summarise(max_price = max(price))
max_prices
```
### Exercises
1. What is the minimum diamond price in this dataset?

```{r}
min(diamonds$price)

```

2. How many diamonds have length at least one and a half times their width?
```{r}
n <- diamonds %>%
  filter(x >= 1.5 * y)
count(n)
```

3. Among diamonds with colors D,E,F,G, what is the median number of carats for diamonds of each cut?

```{r}
diamonds %>%
  filter(color %in% c("D", "E", "F", "G")) %>%
  group_by(cut) %>%
  summarise(median_carat = median(carat, na.rm = TRUE))


```
